!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("spritejs")):"function"==typeof define&&define.amd?define(["spritejs"],e):"object"==typeof exports?exports.ext3d=e(require("spritejs")):(t.spritejs=t.spritejs||{},t.spritejs.ext3d=e(t.spritejs))}(this,(function(t){return function(t){var e=this.webpackHotUpdate;this.webpackHotUpdate=function(t,r){!function(t,e){if(!x[t]||!w[t])return;for(var r in w[t]=!1,e)Object.prototype.hasOwnProperty.call(e,r)&&(g[r]=e[r]);0==--y&&0===v&&S()}(t,r),e&&e(t,r)};var r,i=!0,n="c6ed64b48890803507cb",s=1e4,a={},o=[],h=[];function u(t){var e=O[t];if(!e)return k;var i=function(i){return e.hot.active?(O[i]?-1===O[i].parents.indexOf(t)&&O[i].parents.push(t):(o=[t],r=i),-1===e.children.indexOf(i)&&e.children.push(i)):(console.warn("[HMR] unexpected require("+i+") from disposed module "+t),o=[]),k(i)},n=function(t){return{configurable:!0,enumerable:!0,get:function(){return k[t]},set:function(e){k[t]=e}}};for(var s in k)Object.prototype.hasOwnProperty.call(k,s)&&"e"!==s&&"t"!==s&&Object.defineProperty(i,s,n(s));return i.e=function(t){return"ready"===d&&p("prepare"),v++,k.e(t).then(e,(function(t){throw e(),t}));function e(){v--,"prepare"===d&&(b[t]||A(t),0===v&&0===y&&S())}},i.t=function(t,e){return 1&e&&(t=i(t)),k.t(t,-2&e)},i}function l(t){var e={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:r!==t,active:!0,accept:function(t,r){if(void 0===t)e._selfAccepted=!0;else if("function"==typeof t)e._selfAccepted=t;else if("object"==typeof t)for(var i=0;i<t.length;i++)e._acceptedDependencies[t[i]]=r||function(){};else e._acceptedDependencies[t]=r||function(){}},decline:function(t){if(void 0===t)e._selfDeclined=!0;else if("object"==typeof t)for(var r=0;r<t.length;r++)e._declinedDependencies[t[r]]=!0;else e._declinedDependencies[t]=!0},dispose:function(t){e._disposeHandlers.push(t)},addDisposeHandler:function(t){e._disposeHandlers.push(t)},removeDisposeHandler:function(t){var r=e._disposeHandlers.indexOf(t);r>=0&&e._disposeHandlers.splice(r,1)},check:M,apply:_,status:function(t){if(!t)return d;c.push(t)},addStatusHandler:function(t){c.push(t)},removeStatusHandler:function(t){var e=c.indexOf(t);e>=0&&c.splice(e,1)},data:a[t]};return r=void 0,e}var c=[],d="idle";function p(t){d=t;for(var e=0;e<c.length;e++)c[e].call(null,t)}var f,g,m,y=0,v=0,b={},w={},x={};function E(t){return+t+""===t?+t:t}function M(t){if("idle"!==d)throw new Error("check() is only allowed in idle status");return i=t,p("check"),(e=s,e=e||1e4,new Promise((function(t,r){if("undefined"==typeof XMLHttpRequest)return r(new Error("No browser support"));try{var i=new XMLHttpRequest,s=k.p+""+n+".hot-update.json";i.open("GET",s,!0),i.timeout=e,i.send(null)}catch(t){return r(t)}i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)r(new Error("Manifest request to "+s+" timed out."));else if(404===i.status)t();else if(200!==i.status&&304!==i.status)r(new Error("Manifest request to "+s+" failed."));else{try{var e=JSON.parse(i.responseText)}catch(t){return void r(t)}t(e)}}}))).then((function(t){if(!t)return p("idle"),null;w={},b={},x=t.c,m=t.h,p("prepare");var e=new Promise((function(t,e){f={resolve:t,reject:e}}));g={};return A(0),"prepare"===d&&0===v&&0===y&&S(),e}));var e}function A(t){x[t]?(w[t]=!0,y++,function(t){var e=document.createElement("script");e.charset="utf-8",e.src=k.p+""+t+"."+n+".hot-update.js",document.head.appendChild(e)}(t)):b[t]=!0}function S(){p("ready");var t=f;if(f=null,t)if(i)Promise.resolve().then((function(){return _(i)})).then((function(e){t.resolve(e)}),(function(e){t.reject(e)}));else{var e=[];for(var r in g)Object.prototype.hasOwnProperty.call(g,r)&&e.push(E(r));t.resolve(e)}}function _(e){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var r,i,s,h,u;function l(t){for(var e=[t],r={},i=e.map((function(t){return{chain:[t],id:t}}));i.length>0;){var n=i.pop(),s=n.id,a=n.chain;if((h=O[s])&&!h.hot._selfAccepted){if(h.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:s};if(h.hot._main)return{type:"unaccepted",chain:a,moduleId:s};for(var o=0;o<h.parents.length;o++){var u=h.parents[o],l=O[u];if(l){if(l.hot._declinedDependencies[s])return{type:"declined",chain:a.concat([u]),moduleId:s,parentId:u};-1===e.indexOf(u)&&(l.hot._acceptedDependencies[s]?(r[u]||(r[u]=[]),c(r[u],[s])):(delete r[u],e.push(u),i.push({chain:a.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:t,outdatedModules:e,outdatedDependencies:r}}function c(t,e){for(var r=0;r<e.length;r++){var i=e[r];-1===t.indexOf(i)&&t.push(i)}}e=e||{};var f={},y=[],v={},b=function(){console.warn("[HMR] unexpected require("+M.moduleId+") to disposed module")};for(var w in g)if(Object.prototype.hasOwnProperty.call(g,w)){var M;u=E(w);var A=!1,S=!1,_=!1,P="";switch((M=g[w]?l(u):{type:"disposed",moduleId:w}).chain&&(P="\nUpdate propagation: "+M.chain.join(" -> ")),M.type){case"self-declined":e.onDeclined&&e.onDeclined(M),e.ignoreDeclined||(A=new Error("Aborted because of self decline: "+M.moduleId+P));break;case"declined":e.onDeclined&&e.onDeclined(M),e.ignoreDeclined||(A=new Error("Aborted because of declined dependency: "+M.moduleId+" in "+M.parentId+P));break;case"unaccepted":e.onUnaccepted&&e.onUnaccepted(M),e.ignoreUnaccepted||(A=new Error("Aborted because "+u+" is not accepted"+P));break;case"accepted":e.onAccepted&&e.onAccepted(M),S=!0;break;case"disposed":e.onDisposed&&e.onDisposed(M),_=!0;break;default:throw new Error("Unexception type "+M.type)}if(A)return p("abort"),Promise.reject(A);if(S)for(u in v[u]=g[u],c(y,M.outdatedModules),M.outdatedDependencies)Object.prototype.hasOwnProperty.call(M.outdatedDependencies,u)&&(f[u]||(f[u]=[]),c(f[u],M.outdatedDependencies[u]));_&&(c(y,[M.moduleId]),v[u]=b)}var L,T=[];for(i=0;i<y.length;i++)u=y[i],O[u]&&O[u].hot._selfAccepted&&v[u]!==b&&T.push({module:u,errorHandler:O[u].hot._selfAccepted});p("dispose"),Object.keys(x).forEach((function(t){!1===x[t]&&function(t){delete installedChunks[t]}(t)}));for(var j,F,R=y.slice();R.length>0;)if(u=R.pop(),h=O[u]){var C={},I=h.hot._disposeHandlers;for(s=0;s<I.length;s++)(r=I[s])(C);for(a[u]=C,h.hot.active=!1,delete O[u],delete f[u],s=0;s<h.children.length;s++){var N=O[h.children[s]];N&&((L=N.parents.indexOf(u))>=0&&N.parents.splice(L,1))}}for(u in f)if(Object.prototype.hasOwnProperty.call(f,u)&&(h=O[u]))for(F=f[u],s=0;s<F.length;s++)j=F[s],(L=h.children.indexOf(j))>=0&&h.children.splice(L,1);for(u in p("apply"),n=m,v)Object.prototype.hasOwnProperty.call(v,u)&&(t[u]=v[u]);var D=null;for(u in f)if(Object.prototype.hasOwnProperty.call(f,u)&&(h=O[u])){F=f[u];var B=[];for(i=0;i<F.length;i++)if(j=F[i],r=h.hot._acceptedDependencies[j]){if(-1!==B.indexOf(r))continue;B.push(r)}for(i=0;i<B.length;i++){r=B[i];try{r(F)}catch(t){e.onErrored&&e.onErrored({type:"accept-errored",moduleId:u,dependencyId:F[i],error:t}),e.ignoreErrored||D||(D=t)}}}for(i=0;i<T.length;i++){var U=T[i];u=U.module,o=[u];try{k(u)}catch(t){if("function"==typeof U.errorHandler)try{U.errorHandler(t)}catch(r){e.onErrored&&e.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:r,originalError:t}),e.ignoreErrored||D||(D=r),D||(D=t)}else e.onErrored&&e.onErrored({type:"self-accept-errored",moduleId:u,error:t}),e.ignoreErrored||D||(D=t)}}return D?(p("fail"),Promise.reject(D)):(p("idle"),new Promise((function(t){t(y)})))}var O={};function k(e){if(O[e])return O[e].exports;var r=O[e]={i:e,l:!1,exports:{},hot:l(e),parents:(h=o,o=[],h),children:[]};return t[e].call(r.exports,r,r.exports,u(e)),r.l=!0,r.exports}return k.m=t,k.c=O,k.d=function(t,e,r){k.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},k.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},k.t=function(t,e){if(1&e&&(t=k(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(k.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)k.d(r,i,function(e){return t[e]}.bind(null,i));return r},k.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return k.d(e,"a",e),e},k.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},k.p="/js/",k.h=function(){return n},u(34)(k.s=34)}([function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,r){var i=r(21),n=r(12);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?n(t):e}},function(t,e,r){var i=r(15);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(e,r){e.exports=t},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}},function(t,e,r){var i=r(22);function n(e,r,s){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=n=Reflect.get:t.exports=n=function(t,e,r){var n=i(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(r):s.value}},n(e,r,s||e)}t.exports=n},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e,r){var i=r(18),n=r(19),s=r(20);t.exports=function(t){return i(t)||n(t)||s()}},,function(t,e,r){var i=r(23),n=r(24),s=r(25);t.exports=function(t,e){return i(t)||n(t,e)||s()}},function(t,e,r){t.exports=r(17)},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function r(t,e,r,i,n,s,a){try{var o=t[s](a),h=o.value}catch(t){return void r(t)}o.done?e(h):Promise.resolve(h).then(i,n)}t.exports=function(t){return function(){var e=this,i=arguments;return new Promise((function(n,s){var a=t.apply(e,i);function o(t){r(a,n,s,o,h,"next",t)}function h(t){r(a,n,s,o,h,"throw",t)}o(void 0)}))}}},function(t,e,r){"use strict";var i=r(26),n=r(31),s=r(33);t.exports=function(t){var e,r=i(t);return r.space?((e=Array(3))[0]=s(r.values[0],0,255),e[1]=s(r.values[1],0,255),e[2]=s(r.values[2],0,255),"h"===r.space[0]&&(e=n.rgb(e)),e.push(s(r.alpha,0,1)),e):[]}},function(t,e){function r(e,i){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,i)}t.exports=r},function(t,e,r){var i=r(15);function n(e,r,s){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?t.exports=n=function(t,e,r){var n=[null];n.push.apply(n,e);var s=new(Function.bind.apply(t,n));return r&&i(s,r.prototype),s}:t.exports=n=Reflect.construct,n.apply(null,arguments)}t.exports=n},function(t,e,r){var i=function(t){"use strict";var e,r=Object.prototype,i=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function h(t,e,r,i){var n=e&&e.prototype instanceof g?e:g,s=Object.create(n.prototype),a=new O(i||[]);return s._invoke=function(t,e,r){var i=l;return function(n,s){if(i===d)throw new Error("Generator is already running");if(i===p){if("throw"===n)throw s;return P()}for(r.method=n,r.arg=s;;){var a=r.delegate;if(a){var o=A(a,r);if(o){if(o===f)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===l)throw i=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var h=u(t,e,r);if("normal"===h.type){if(i=r.done?p:c,h.arg===f)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(i=p,r.method="throw",r.arg=h.arg)}}}(t,r,a),s}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var l="suspendedStart",c="suspendedYield",d="executing",p="completed",f={};function g(){}function m(){}function y(){}var v={};v[s]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(k([])));w&&w!==r&&i.call(w,s)&&(v=w);var x=y.prototype=g.prototype=Object.create(v);function E(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function M(t){var e;this._invoke=function(r,n){function s(){return new Promise((function(e,s){!function e(r,n,s,a){var o=u(t[r],t,n);if("throw"!==o.type){var h=o.arg,l=h.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(t){e("next",t,s,a)}),(function(t){e("throw",t,s,a)})):Promise.resolve(l).then((function(t){h.value=t,s(h)}),(function(t){return e("throw",t,s,a)}))}a(o.arg)}(r,n,e,s)}))}return e=e?e.then(s,s):s()}}function A(t,r){var i=t.iterator[r.method];if(i===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=u(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,f;var s=n.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function k(t){if(t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:e,done:!0}}return m.prototype=x.constructor=y,y.constructor=m,y[o]=m.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},E(M.prototype),M.prototype[a]=function(){return this},t.AsyncIterator=M,t.async=function(e,r,i,n){var s=new M(h(e,r,i,n));return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},E(x),x[o]="Generator",x[s]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=k,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return o.type="throw",o.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var h=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(h&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(h){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;_(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:k(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e,r){var i=r(0);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],i=!0,n=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(r.push(a.value),!e||r.length!==e);i=!0);}catch(t){n=!0,s=t}finally{try{i||null==o.return||o.return()}finally{if(n)throw s}}return r}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e,r){"use strict";(function(e){var i=r(28),n=r(29),s=r(30);t.exports=function(t){var r,o,h=[],u=1;if("string"==typeof t)if(i[t])h=i[t].slice(),o="rgb";else if("transparent"===t)u=0,o="rgb",h=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(t)){var l=(p=t.slice(1)).length;u=1,l<=4?(h=[parseInt(p[0]+p[0],16),parseInt(p[1]+p[1],16),parseInt(p[2]+p[2],16)],4===l&&(u=parseInt(p[3]+p[3],16)/255)):(h=[parseInt(p[0]+p[1],16),parseInt(p[2]+p[3],16),parseInt(p[4]+p[5],16)],8===l&&(u=parseInt(p[6]+p[7],16)/255)),h[0]||(h[0]=0),h[1]||(h[1]=0),h[2]||(h[2]=0),o="rgb"}else if(r=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(t)){var c=r[1],d="rgb"===c,p=c.replace(/a$/,"");o=p;l="cmyk"===p?4:"gray"===p?1:3;h=r[2].trim().split(/\s*,\s*/).map((function(t,e){if(/%$/.test(t))return e===l?parseFloat(t)/100:"rgb"===p?255*parseFloat(t)/100:parseFloat(t);if("h"===p[e]){if(/deg$/.test(t))return parseFloat(t);if(void 0!==a[t])return a[t]}return parseFloat(t)})),c===p&&h.push(1),u=d?1:void 0===h[l]?1:h[l],h=h.slice(0,l)}else t.length>10&&/[0-9](?:\s|\/)/.test(t)&&(h=t.match(/([0-9]+)/g).map((function(t){return parseFloat(t)})),o=t.match(/([a-z])/gi).join("").toLowerCase());else if(isNaN(t))if(n(t)){var f=s(t.r,t.red,t.R,null);null!==f?(o="rgb",h=[f,s(t.g,t.green,t.G),s(t.b,t.blue,t.B)]):(o="hsl",h=[s(t.h,t.hue,t.H),s(t.s,t.saturation,t.S),s(t.l,t.lightness,t.L,t.b,t.brightness)]),u=s(t.a,t.alpha,t.opacity,1),null!=t.opacity&&(u/=100)}else(Array.isArray(t)||e.ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(t))&&(h=[t[0],t[1],t[2]],o="rgb",u=4===t.length?t[3]:1);else o="rgb",h=[t>>>16,(65280&t)>>>8,255&t];return{space:o,values:h,alpha:u}};var a={red:0,orange:60,yellow:120,green:180,blue:240,purple:300}}).call(this,r(27))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(t,e,r){"use strict";var i=Object.prototype.toString;t.exports=function(t){var e;return"[object Object]"===i.call(t)&&(null===(e=Object.getPrototypeOf(t))||e===Object.getPrototypeOf({}))}},function(t,e){t.exports=function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]}},function(t,e,r){"use strict";var i=r(32);t.exports={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(t){var e,r,i,n,s,a=t[0]/360,o=t[1]/100,h=t[2]/100;if(0===o)return[s=255*h,s,s];e=2*h-(r=h<.5?h*(1+o):h+o-h*o),n=[0,0,0];for(var u=0;u<3;u++)(i=a+1/3*-(u-1))<0?i++:i>1&&i--,s=6*i<1?e+6*(r-e)*i:2*i<1?r:3*i<2?e+(r-e)*(2/3-i)*6:e,n[u]=255*s;return n}},i.hsl=function(t){var e,r,i=t[0]/255,n=t[1]/255,s=t[2]/255,a=Math.min(i,n,s),o=Math.max(i,n,s),h=o-a;return o===a?e=0:i===o?e=(n-s)/h:n===o?e=2+(s-i)/h:s===o&&(e=4+(i-n)/h),(e=Math.min(60*e,360))<0&&(e+=360),r=(a+o)/2,[e,100*(o===a?0:r<=.5?h/(o+a):h/(2-o-a)),100*r]}},function(t,e,r){"use strict";t.exports={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]}},function(t,e){t.exports=function(t,e,r){return e<r?t<e?e:t>r?r:t:t<r?r:t>e?e:t}},function(t,e,r){"use strict";r.r(e);var i={};r.r(i),r.d(i,"BASE_GEOMETRY",(function(){return $e})),r.d(i,"GEOMETRY_WITH_TEXTURE",(function(){return Qe}));var n=r(4),s=r(11),a=r.n(s),o=r(13),h=r.n(o),u=r(16),l=r.n(u),c=r(8),d=r.n(c),p=r(7),f=r.n(p),g=r(1),m=r.n(g),y=r(5),v=r.n(y),b=r(2),w=r.n(b),x=r(12),E=r.n(x),M=r(0),A=r.n(M),S=r(6),_=r.n(S),O=r(3),k=r.n(O);function P(t){let e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function L(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function T(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function j(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function F(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function R(t,e){let r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function C(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function I(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],h=r[2];return t[0]=n*h-s*o,t[1]=s*a-i*h,t[2]=i*o-n*a,t}const N=function(){const t=[0,0,0],e=[0,0,0];return function(r,i){L(t,r),L(e,i),R(t,t),R(e,e);let n=C(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();class D extends Array{constructor(t=0,e=t,r=t){return super(t,e,r),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}set(t,e=t,r=t){return t.length?this.copy(t):(function(t,e,r,i){t[0]=e,t[1]=r,t[2]=i}(this,t,e,r),this)}copy(t){return L(this,t),this}add(t,e){return e?T(this,t,e):T(this,this,t),this}sub(t,e){return e?j(this,t,e):j(this,this,t),this}multiply(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]*i[0],e[1]=r[1]*i[1],e[2]=r[2]*i[2]):F(this,this,t),this}divide(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]/i[0],e[1]=r[1]/i[1],e[2]=r[2]/i[2]):F(this,this,1/t),this}inverse(t=this){var e,r;return r=t,(e=this)[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],this}len(){return P(this)}distance(t){return t?function(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}(this,t):P(this)}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?function(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}(this,t):function(t){let e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}(this)}negate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],this}cross(t,e){return I(this,t,e),this}scale(t){return F(this,this,t),this}normalize(){return R(this,this),this}dot(t){return C(this,t)}equals(t){return r=t,(e=this)[0]===r[0]&&e[1]===r[1]&&e[2]===r[2];var e,r}applyMatrix4(t){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a}(this,this,t),this}applyQuaternion(t){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[0],o=r[1],h=r[2],u=o*s-h*n,l=h*i-a*s,c=a*n-o*i,d=o*c-h*l,p=h*u-a*c,f=a*l-o*u,g=2*r[3];u*=g,l*=g,c*=g,d*=2,p*=2,f*=2,t[0]=i+u+d,t[1]=n+l+p,t[2]=s+c+f}(this,this,t),this}angle(t){return N(this,t)}lerp(t,e){return function(t,e,r,i){let n=e[0],s=e[1],a=e[2];t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a)}(this,this,t,e),this}clone(){return new D(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],r=this[1],i=this[2];return this[0]=t[0]*e+t[4]*r+t[8]*i,this[1]=t[1]*e+t[5]*r+t[9]*i,this[2]=t[2]*e+t[6]*r+t[10]*i,this.normalize()}}const B=new D;class U{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:r=150,dpr:i=1,alpha:n=!1,depth:s=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:h=!1,preserveDrawingBuffer:u=!1,powerPreference:l="default",autoClear:c=!0,webgl:d=2}={}){const p={alpha:n,depth:s,stencil:a,antialias:o,premultipliedAlpha:h,preserveDrawingBuffer:u,powerPreference:l};this.dpr=i,this.alpha=n,this.color=!0,this.depth=s,this.stencil=a,this.premultipliedAlpha=h,this.autoClear=c,2===d&&(this.gl=t.getContext("webgl2",p)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",p)||t.getContext("experimental-webgl",p)),this.gl.renderer=this,this.setSize(e,r),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,r,i){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===r&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=r,this.state.blendFunc.dstAlpha=i,void 0!==r?this.gl.blendFuncSeparate(t,e,r,i):this.gl.blendFunc(t,e))}setBlendEquation(t,e){this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,r){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][r].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:r,sort:i}){let n=[];if(e&&r&&e.updateFrustum(),t.traverse(t=>{if(!t.visible)return!0;t.draw&&(r&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||n.push(t))}),i){const t=[],r=[],i=[];n.forEach(n=>{n.program.transparent?n.program.depthTest?r.push(n):i.push(n):t.push(n),n.zDepth=0,0===n.renderOrder&&n.program.depthTest&&e&&(n.worldMatrix.getTranslation(B),B.applyMatrix4(e.projectionViewMatrix),n.zDepth=B.z)}),t.sort(this.sortOpaque),r.sort(this.sortTransparent),i.sort(this.sortUI),n=t.concat(r,i)}return n}render({scene:t,camera:e,target:r=null,update:i=!0,sort:n=!0,frustumCull:s=!0,clear:a}){null===r?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||r&&!r.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&t.updateMatrixWorld(),e&&null===e.parent&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:s,sort:n}).forEach(t=>{t.draw({camera:e})})}}let z=1;const q={};class X{constructor(t,{vertex:e,fragment:r,uniforms:i={},transparent:n=!1,cullFace:s=t.BACK,frontFace:a=t.CCW,depthTest:o=!0,depthWrite:h=!0,depthFunc:u=t.LESS}={}){this.gl=t,this.uniforms=i,this.id=z++,e||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=s,this.frontFace=a,this.depthTest=o,this.depthWrite=h,this.depthFunc=u,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const l=t.createShader(t.VERTEX_SHADER);t.shaderSource(l,e),t.compileShader(l),""!==t.getShaderInfoLog(l)&&console.warn(`${t.getShaderInfoLog(l)}\nVertex Shader\n${G(e)}`);const c=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(c,r),t.compileShader(c),""!==t.getShaderInfoLog(c)&&console.warn(`${t.getShaderInfoLog(c)}\nFragment Shader\n${G(r)}`),this.program=t.createProgram(),t.attachShader(this.program,l),t.attachShader(this.program,c),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(l),t.deleteShader(c),this.uniformLocations=new Map;let d=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<d;e++){let r=t.getActiveUniform(this.program,e);this.uniformLocations.set(r,t.getUniformLocation(this.program,r.name));const i=r.name.match(/(\w+)/g);r.uniformName=i[0],3===i.length?(r.isStructArray=!0,r.structIndex=Number(i[1]),r.structProperty=i[2]):2===i.length&&isNaN(Number(i[1]))&&(r.isStruct=!0,r.structProperty=i[1])}this.attributeLocations=new Map;const p=[],f=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<f;e++){const r=t.getActiveAttrib(this.program,e),i=t.getAttribLocation(this.program,r.name);p[i]=r.name,this.attributeLocations.set(r.name,i)}this.attributeOrder=p.join("")}setBlendFunc(t,e,r,i){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=r,this.blendFunc.dstAlpha=i,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((t,r)=>{let i=r.uniformName,n=this.uniforms[i];if(r.isStruct&&(n=n[r.structProperty],i+=`.${r.structProperty}`),r.isStructArray&&(n=n[r.structIndex][r.structProperty],i+=`[${r.structIndex}].${r.structProperty}`),!n)return H(`Active uniform ${i} has not been supplied`);if(n&&void 0===n.value)return H(`${i} uniform is missing a value parameter`);if(n.value.texture)return e+=1,n.value.update(e),Y(this.gl,r.type,t,e);if(n.value.length&&n.value[0].texture){const i=[];return n.value.forEach(t=>{e+=1,t.update(e),i.push(e)}),Y(this.gl,r.type,t,i)}Y(this.gl,r.type,t,n.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function Y(t,e,r,i){i=i.length?function(t){const e=t.length,r=t[0].length;if(void 0===r)return t;const i=e*r;let n=q[i];n||(q[i]=n=new Float32Array(i));for(let i=0;i<e;i++)n.set(t[i],i*r);return n}(i):i;const n=t.renderer.state.uniformLocations.get(r);if(i.length)if(void 0===n)t.renderer.state.uniformLocations.set(r,i.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let r=0,i=t.length;r<i;r++)if(t[r]!==e[r])return!1;return!0}(n,i))return;n.set?n.set(i):function(t,e){for(let r=0,i=t.length;r<i;r++)t[r]=e[r]}(n,i),t.renderer.state.uniformLocations.set(r,n)}else{if(n===i)return;t.renderer.state.uniformLocations.set(r,i)}switch(e){case 5126:return i.length?t.uniform1fv(r,i):t.uniform1f(r,i);case 35664:return t.uniform2fv(r,i);case 35665:return t.uniform3fv(r,i);case 35666:return t.uniform4fv(r,i);case 35670:case 5124:case 35678:case 35680:return i.length?t.uniform1iv(r,i):t.uniform1i(r,i);case 35671:case 35667:return t.uniform2iv(r,i);case 35672:case 35668:return t.uniform3iv(r,i);case 35673:case 35669:return t.uniform4iv(r,i);case 35674:return t.uniformMatrix2fv(r,!1,i);case 35675:return t.uniformMatrix3fv(r,!1,i);case 35676:return t.uniformMatrix4fv(r,!1,i)}}function G(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let V=0;function H(t){V>100||(console.warn(t),V++,V>100&&console.warn("More than 100 program warnings - stopping logs."))}function Z(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function W(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function $(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Q(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}class K extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(function(t,e,r){t[0]=e,t[1]=r}(this,t,e),this)}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],this}add(t,e){return e?Z(this,t,e):Z(this,this,t),this}sub(t,e){return e?W(this,t,e):W(this,this,t),this}multiply(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]*i[0],e[1]=r[1]*i[1]):$(this,this,t),this}divide(t){var e,r,i;return t.length?(r=this,i=t,(e=this)[0]=r[0]/i[0],e[1]=r[1]/i[1]):$(this,this,1/t),this}inverse(t=this){var e,r;return r=t,(e=this)[0]=1/r[0],e[1]=1/r[1],this}len(){return Q(this)}distance(t){return t?(e=this,i=(r=t)[0]-e[0],n=r[1]-e[1],Math.sqrt(i*i+n*n)):Q(this);var e,r,i,n}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(e=this,i=(r=t)[0]-e[0],n=r[1]-e[1],i*i+n*n):function(t){var e=t[0],r=t[1];return e*e+r*r}(this);var e,r,i,n}negate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],this}cross(t,e){return i=e,(r=t)[0]*i[1]-r[1]*i[0];var r,i}scale(t){return $(this,this,t),this}normalize(){var t,e,r,i,n;return t=this,r=(e=this)[0],i=e[1],(n=r*r+i*i)>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,this}dot(t){return r=t,(e=this)[0]*r[0]+e[1]*r[1];var e,r}equals(t){return r=t,(e=this)[0]===r[0]&&e[1]===r[1];var e,r}applyMatrix3(t){var e,r,i,n,s;return e=this,i=t,n=(r=this)[0],s=r[1],e[0]=i[0]*n+i[3]*s+i[6],e[1]=i[1]*n+i[4]*s+i[7],this}applyMatrix4(t){return function(t,e,r){let i=e[0],n=e[1];t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13]}(this,this,t),this}lerp(t,e){!function(t,e,r,i){var n=e[0],s=e[1];t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s)}(this,this,t,e)}clone(){return new K(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}const J={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,DOLLY_PAN:3},tt=new D,et=new K,rt=new K;function it(t,{element:e=document,enabled:r=!0,target:i=new D,ease:n=.25,inertia:s=.85,enableRotate:a=!0,rotateSpeed:o=.1,enableZoom:h=!0,zoomSpeed:u=1,enablePan:l=!0,panSpeed:c=.1,minPolarAngle:d=0,maxPolarAngle:p=Math.PI,minAzimuthAngle:f=-1/0,maxAzimuthAngle:g=1/0,minDistance:m=0,maxDistance:y=1/0}={}){this.enabled=r,this.target=i,n=n||1,s=s||1,this.minDistance=m,this.maxDistance=y;const v={radius:1,phi:0,theta:0},b={radius:1,phi:0,theta:0},w={radius:1,phi:0,theta:0},x=new D,E=new D;E.copy(t.position).sub(this.target),w.radius=b.radius=E.distance(),w.theta=b.theta=Math.atan2(E.x,E.z),w.phi=b.phi=Math.acos(Math.min(Math.max(E.y/b.radius,-1),1)),this.update=()=>{b.radius*=v.radius,b.theta+=v.theta,b.phi+=v.phi,b.theta=Math.max(f,Math.min(g,b.theta)),b.phi=Math.max(d,Math.min(p,b.phi)),b.radius=Math.max(this.minDistance,Math.min(this.maxDistance,b.radius)),w.phi+=(b.phi-w.phi)*n,w.theta+=(b.theta-w.theta)*n,w.radius+=(b.radius-w.radius)*n,this.target.add(x);let e=w.radius*Math.sin(Math.max(1e-6,w.phi));E.x=e*Math.sin(w.theta),E.y=w.radius*Math.cos(w.phi),E.z=e*Math.cos(w.theta),t.position.copy(this.target).add(E),t.lookAt(this.target),v.theta*=s,v.phi*=s,x.multiply(s),v.radius=1};const M=new K,A=new K,S=new K;let _=J.NONE;function O(){return Math.pow(.95,u)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const k=(r,i)=>{let n=e===document?document.body:e;tt.copy(t.position).sub(this.target);let s=tt.distance();s*=Math.tan((t.fov||45)/2*Math.PI/180),function(t,e){tt.set(e[0],e[1],e[2]),tt.multiply(-t),x.add(tt)}(2*r*s/n.clientHeight,t.matrix),function(t,e){tt.set(e[4],e[5],e[6]),tt.multiply(t),x.add(tt)}(2*i*s/n.clientHeight,t.matrix)};function P(t){v.radius/=t}function L(t,r){et.set(t,r),rt.sub(et,M).multiply(o);let i=e===document?document.body:e;v.theta-=2*Math.PI*rt.x/i.clientHeight,v.phi-=2*Math.PI*rt.y/i.clientHeight,M.copy(et)}function T(t,e){et.set(t,e),rt.sub(et,A).multiply(c),k(rt.x,rt.y),A.copy(et)}const j=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===a)return;M.set(t.clientX,t.clientY),_=J.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===h)return;S.set(t.clientX,t.clientY),_=J.DOLLY;break;case this.mouseButtons.PAN:if(!1===l)return;A.set(t.clientX,t.clientY),_=J.PAN}_!==J.NONE&&(window.addEventListener("mousemove",F,!1),window.addEventListener("mouseup",R,!1))}},F=t=>{if(this.enabled)switch(_){case J.ROTATE:if(!1===a)return;L(t.clientX,t.clientY);break;case J.DOLLY:if(!1===h)return;!function(t){et.set(t.clientX,t.clientY),rt.sub(et,S),rt.y>0?P(O()):rt.y<0&&P(1/O()),S.copy(et)}(t);break;case J.PAN:if(!1===l)return;T(t.clientX,t.clientY)}},R=()=>{this.enabled&&(document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",R,!1),_=J.NONE)},C=t=>{this.enabled&&h&&(_===J.NONE||_===J.ROTATE)&&(t.stopPropagation(),t.deltaY<0?P(1/O()):t.deltaY>0&&P(O()))},I=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===a)return;M.set(t.touches[0].pageX,t.touches[0].pageY),_=J.ROTATE;break;case 2:if(!1===h&&!1===l)return;!function(t){if(h){let e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);S.set(0,i)}if(l){let e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);A.set(e,r)}}(t),_=J.DOLLY_PAN;break;default:_=J.NONE}},N=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===a)return;L(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===h&&!1===l)return;!function(t){if(h){let e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+r*r);et.set(0,i),rt.set(0,Math.pow(et.y/S.y,u)),P(rt.y),S.copy(et)}if(l){T(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}}(t);break;default:_=J.NONE}},B=()=>{this.enabled&&(_=J.NONE)},U=t=>{this.enabled&&t.preventDefault()};this.remove=function(){e.removeEventListener("contextmenu",U,!1),e.removeEventListener("mousedown",j,!1),window.removeEventListener("wheel",C,!1),e.removeEventListener("touchstart",I,!1),e.removeEventListener("touchend",B,!1),e.removeEventListener("touchmove",N,!1),window.removeEventListener("mousemove",F,!1),window.removeEventListener("mouseup",R,!1)},e.addEventListener("contextmenu",U,!1),e.addEventListener("mousedown",j,!1),window.addEventListener("wheel",C,!1),e.addEventListener("touchstart",I,{passive:!1}),e.addEventListener("touchend",B,!1),e.addEventListener("touchmove",N,{passive:!1})}function nt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function st(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],y=e[14],v=e[15],b=r[0],w=r[1],x=r[2],E=r[3];return t[0]=b*i+w*o+x*c+E*g,t[1]=b*n+w*h+x*d+E*m,t[2]=b*s+w*u+x*p+E*y,t[3]=b*a+w*l+x*f+E*v,b=r[4],w=r[5],x=r[6],E=r[7],t[4]=b*i+w*o+x*c+E*g,t[5]=b*n+w*h+x*d+E*m,t[6]=b*s+w*u+x*p+E*y,t[7]=b*a+w*l+x*f+E*v,b=r[8],w=r[9],x=r[10],E=r[11],t[8]=b*i+w*o+x*c+E*g,t[9]=b*n+w*h+x*d+E*m,t[10]=b*s+w*u+x*p+E*y,t[11]=b*a+w*l+x*f+E*v,b=r[12],w=r[13],x=r[14],E=r[15],t[12]=b*i+w*o+x*c+E*g,t[13]=b*n+w*h+x*d+E*m,t[14]=b*s+w*u+x*p+E*y,t[15]=b*a+w*l+x*f+E*v,t}class at extends Array{constructor(t=1,e=0,r=0,i=0,n=0,s=1,a=0,o=0,h=0,u=0,l=1,c=0,d=0,p=0,f=0,g=1){return super(t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g),this}set x(t){this[12]=t}get x(){return this[12]}set y(t){this[13]=t}get y(){return this[13]}set z(t){this[14]=t}get z(){return this[14]}set w(t){this[15]=t}get w(){return this[15]}set(t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g){return t.length?this.copy(t):(function(t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g,m){t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=d,t[12]=p,t[13]=f,t[14]=g,t[15]=m}(this,t,e,r,i,n,s,a,o,h,u,l,c,d,p,f,g),this)}translate(t,e=this){return function(t,e,r){let i,n,s,a,o,h,u,l,c,d,p,f,g=r[0],m=r[1],y=r[2];e===t?(t[12]=e[0]*g+e[4]*m+e[8]*y+e[12],t[13]=e[1]*g+e[5]*m+e[9]*y+e[13],t[14]=e[2]*g+e[6]*m+e[10]*y+e[14],t[15]=e[3]*g+e[7]*m+e[11]*y+e[15]):(i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],p=e[10],f=e[11],t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=d,t[10]=p,t[11]=f,t[12]=i*g+o*m+c*y+e[12],t[13]=n*g+h*m+d*y+e[13],t[14]=s*g+u*m+p*y+e[14],t[15]=a*g+l*m+f*y+e[15])}(this,e,t),this}rotateX(t,e=this){return function(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[4],a=e[5],o=e[6],h=e[7],u=e[8],l=e[9],c=e[10],d=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+u*i,t[5]=a*n+l*i,t[6]=o*n+c*i,t[7]=h*n+d*i,t[8]=u*n-s*i,t[9]=l*n-a*i,t[10]=c*n-o*i,t[11]=d*n-h*i}(this,e,t),this}rotateY(t,e=this){return function(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],h=e[3],u=e[8],l=e[9],c=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-u*i,t[1]=a*n-l*i,t[2]=o*n-c*i,t[3]=h*n-d*i,t[8]=s*i+u*n,t[9]=a*i+l*n,t[10]=o*i+c*n,t[11]=h*i+d*n}(this,e,t),this}rotateZ(t,e=this){return function(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],o=e[2],h=e[3],u=e[4],l=e[5],c=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+u*i,t[1]=a*n+l*i,t[2]=o*n+c*i,t[3]=h*n+d*i,t[4]=u*n-s*i,t[5]=l*n-a*i,t[6]=c*n-o*i,t[7]=d*n-h*i}(this,e,t),this}scale(t,e=this){return function(t,e,r){let i=r[0],n=r[1],s=r[2];t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,e,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?st(this,t,e):st(this,this,t),this}identity(){return nt(this),this}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}fromPerspective({fov:t,aspect:e,near:r,far:i}={}){return function(t,e,r,i,n){let s=1/Math.tan(e/2),a=1/(i-n);t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*a,t[15]=0}(this,t,e,r,i),this}fromOrthogonal({left:t,right:e,bottom:r,top:i,near:n,far:s}){return function(t,e,r,i,n,s,a){let o=1/(e-r),h=1/(i-n),u=1/(s-a);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*h,t[14]=(a+s)*u,t[15]=1}(this,t,e,r,i,n,s),this}fromQuaternion(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,h=n+n,u=r*a,l=i*a,c=i*o,d=n*a,p=n*o,f=n*h,g=s*a,m=s*o,y=s*h;t[0]=1-c-f,t[1]=l+y,t[2]=d-m,t[3]=0,t[4]=l-y,t[5]=1-u-f,t[6]=p+g,t[7]=0,t[8]=d+m,t[9]=p-g,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],y=e[15],v=r*o-i*a,b=r*h-n*a,w=r*u-s*a,x=i*h-n*o,E=i*u-s*o,M=n*u-s*h,A=l*g-c*f,S=l*m-d*f,_=l*y-p*f,O=c*m-d*g,k=c*y-p*g,P=d*y-p*m,L=v*P-b*k+w*O+x*_-E*S+M*A;L&&(L=1/L,t[0]=(o*P-h*k+u*O)*L,t[1]=(n*k-i*P-s*O)*L,t[2]=(g*M-m*E+y*x)*L,t[3]=(d*E-c*M-p*x)*L,t[4]=(h*_-a*P-u*S)*L,t[5]=(r*P-n*_+s*S)*L,t[6]=(m*w-f*M-y*b)*L,t[7]=(l*M-d*w+p*b)*L,t[8]=(a*k-o*_+u*A)*L,t[9]=(i*_-r*k-s*A)*L,t[10]=(f*E-g*w+y*v)*L,t[11]=(c*w-l*E-p*v)*L,t[12]=(o*S-a*O-h*A)*L,t[13]=(r*O-i*S+n*A)*L,t[14]=(g*b-f*x-m*v)*L,t[15]=(l*x-c*b+d*v)*L)}(this,t),this}compose(t,e,r){return function(t,e,r,i){let n=e[0],s=e[1],a=e[2],o=e[3],h=n+n,u=s+s,l=a+a,c=n*h,d=n*u,p=n*l,f=s*u,g=s*l,m=a*l,y=o*h,v=o*u,b=o*l,w=i[0],x=i[1],E=i[2];t[0]=(1-(f+m))*w,t[1]=(d+b)*w,t[2]=(p-v)*w,t[3]=0,t[4]=(d-b)*x,t[5]=(1-(c+m))*x,t[6]=(g+y)*x,t[7]=0,t[8]=(p+v)*E,t[9]=(g-y)*E,t[10]=(1-(c+f))*E,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1}(this,t,e,r),this}getRotation(t){return function(t,e){let r=e[0]+e[5]+e[10],i=0;r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i)}(t,this),this}getTranslation(t){var e,r;return r=this,(e=t)[0]=r[12],e[1]=r[13],e[2]=r[14],this}getScaling(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],o=e[6],h=e[8],u=e[9],l=e[10];t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+a*a+o*o),t[2]=Math.sqrt(h*h+u*u+l*l)}(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],r=t[1],i=t[2],n=t[4],s=t[5],a=t[6],o=t[8],h=t[9],u=t[10];const l=e*e+r*r+i*i,c=n*n+s*s+a*a,d=o*o+h*h+u*u;return Math.sqrt(Math.max(l,c,d))}(this)}lookAt(t,e,r){return function(t,e,r,i){let n=e[0],s=e[1],a=e[2],o=i[0],h=i[1],u=i[2],l=n-r[0],c=s-r[1],d=a-r[2],p=l*l+c*c+d*d;p>0&&(p=1/Math.sqrt(p),l*=p,c*=p,d*=p);let f=h*d-u*c,g=u*l-o*d,m=o*c-h*l;p=f*f+g*g+m*m,p>0&&(p=1/Math.sqrt(p),f*=p,g*=p,m*=p),t[0]=f,t[1]=g,t[2]=m,t[3]=0,t[4]=c*m-d*g,t[5]=d*f-l*m,t[6]=l*g-c*f,t[7]=0,t[8]=l,t[9]=c,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1}(this,t,e,r),this}determinant(){return function(t){let e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],p=t[12],f=t[13],g=t[14],m=t[15];return(e*a-r*s)*(c*m-d*g)-(e*o-i*s)*(l*m-d*f)+(e*h-n*s)*(l*g-c*f)+(r*o-i*a)*(u*m-d*p)-(r*h-n*a)*(u*g-c*p)+(i*h-n*o)*(u*f-l*p)}(this)}}const ot=new D,ht=new D,ut=new D,lt=new at;class ct{constructor(t){this.gl=t,this.origin=new D,this.direction=new D}castMouse(t,e=[0,0]){t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(t){Array.isArray(t)||(t=[t]);const e=lt,r=ot,i=ht,n=[];return t.forEach(t=>{t.geometry.bounds||t.geometry.computeBoundingBox(),"sphere"===t.geometry.raycast&&t.geometry.bounds.radius===1/0&&t.geometry.computeBoundingSphere(),e.inverse(t.worldMatrix),r.copy(this.origin).applyMatrix4(e),i.copy(this.direction).transformDirection(e);let s=0;s="sphere"===t.geometry.raycast?this.intersectSphere(t.geometry.bounds,r,i):this.intersectBox(t.geometry.bounds,r,i),s&&(t.hit||(t.hit={localPoint:new D}),t.hit.distance=s,t.hit.localPoint.copy(i).multiply(s).add(r),n.push(t))}),n.sort((t,e)=>t.hit.distance-e.hit.distance),n}intersectSphere(t,e=this.origin,r=this.direction){const i=ut;i.sub(t.center,e);const n=i.dot(r),s=i.dot(i)-n*n,a=t.radius*t.radius;if(s>a)return 0;const o=Math.sqrt(a-s),h=n-o,u=n+o;return h<0&&u<0?0:h<0?u:h}intersectBox(t,e=this.origin,r=this.direction){let i,n,s,a,o,h;const u=1/r.x,l=1/r.y,c=1/r.z,d=t.min,p=t.max;return i=((u>=0?d.x:p.x)-e.x)*u,n=((u>=0?p.x:d.x)-e.x)*u,s=((l>=0?d.y:p.y)-e.y)*l,a=((l>=0?p.y:d.y)-e.y)*l,i>a||s>n?0:(s>i&&(i=s),a<n&&(n=a),o=((c>=0?d.z:p.z)-e.z)*c,h=((c>=0?p.z:d.z)-e.z)*c,i>h||o>n?0:(o>i&&(i=o),h<n&&(n=h),n<0?0:i>=0?i:n))}}const dt=new Uint8Array(4);function pt(t){return 0==(t&t-1)}let ft=1;class gt{constructor(t,{image:e,target:r=t.TEXTURE_2D,type:i=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:s=n,wrapS:a=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:h=!0,minFilter:u=(h?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:l=t.LINEAR,premultiplyAlpha:c=!1,unpackAlignment:d=4,flipY:p=r==t.TEXTURE_2D,anisotropy:f=0,level:g=0,width:m,height:y=m}={}){this.gl=t,this.id=ft++,this.image=e,this.target=r,this.type=i,this.format=n,this.internalFormat=s,this.minFilter=u,this.magFilter=l,this.wrapS=a,this.wrapT=o,this.generateMipmaps=h,this.premultiplyAlpha=c,this.unpackAlignment=d,this.flipY=p,this.anisotropy=Math.min(f,this.gl.renderer.parameters.maxAnisotropy),this.level=g,this.width=m,this.height=y,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let t=0;t<this.image.length;t++)this.gl.compressedTexImage2D(this.target,t,this.internalFormat,this.image[t].width,this.image[t].height,0,this.image[t].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||pt(this.image.width)&&pt(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,dt);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,dt);this.store.image=this.image,this.onUpdate&&this.onUpdate()}}}function mt(t,e,r){r*=.5;let i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function yt(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=r[0],h=r[1],u=r[2],l=r[3];return t[0]=i*l+a*o+n*u-s*h,t[1]=n*l+a*h+s*o-i*u,t[2]=s*l+a*u+i*h-n*o,t[3]=a*l-i*o-n*h-s*u,t}function vt(t,e,r,i){let n,s,a,o,h,u=e[0],l=e[1],c=e[2],d=e[3],p=r[0],f=r[1],g=r[2],m=r[3];return s=u*p+l*f+c*g+d*m,s<0&&(s=-s,p=-p,f=-f,g=-g,m=-m),1-s>1e-6?(n=Math.acos(s),a=Math.sin(n),o=Math.sin((1-i)*n)/a,h=Math.sin(i*n)/a):(o=1-i,h=i),t[0]=o*u+h*p,t[1]=o*l+h*f,t[2]=o*c+h*g,t[3]=o*d+h*m,t}function bt(t,e){let r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);let n=(i+1)%3,s=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*n+s]-e[3*s+n])*r,t[n]=(e[3*n+i]+e[3*i+n])*r,t[s]=(e[3*s+i]+e[3*i+s])*r}return t}const wt=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},xt=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},Et=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Mt=function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=s*a,t};(function(){const t=[0,0,0],e=[1,0,0],r=[0,1,0]})(),function(){let t=[0,0,0,1],e=[0,0,0,1]}(),function(){const t=[1,0,0,0,1,0,0,0,1]}();class At extends Array{constructor(t=0,e=0,r=0,i=1){return super(t,e,r,i),this.onChange=()=>{},this}get x(){return this[0]}set x(t){this[0]=t,this.onChange()}get y(){return this[1]}set y(t){this[1]=t,this.onChange()}get z(){return this[2]}set z(t){this[2]=t,this.onChange()}get w(){return this[3]}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,r,i){return t.length?this.copy(t):(xt(this,t,e,r,i),this.onChange(),this)}rotateX(t){return function(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=i*h+a*o,t[1]=n*h+s*o,t[2]=s*h-n*o,t[3]=a*h-i*o}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=i*h-s*o,t[1]=n*h+a*o,t[2]=s*h+i*o,t[3]=a*h-n*o}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);t[0]=i*h+n*o,t[1]=n*h-i*o,t[2]=s*h+a*o,t[3]=a*h-s*o}(this,this,t),this.onChange(),this}inverse(t=this){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;t[0]=-r*o,t[1]=-i*o,t[2]=-n*o,t[3]=s*o}(this,t),this.onChange(),this}conjugate(t=this){var e,r;return r=t,(e=this)[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=r[3],this.onChange(),this}copy(t){return wt(this,t),this.onChange(),this}normalize(t=this){return Mt(this,t),this.onChange(),this}multiply(t,e){return e?yt(this,t,e):yt(this,this,t),this.onChange(),this}dot(t){return Et(this,t)}fromMatrix3(t){return bt(this,t),this.onChange(),this}fromEuler(t){return function(t,e,r="YXZ"){let i=Math.sin(.5*e[0]),n=Math.cos(.5*e[0]),s=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===r?(t[0]=i*a*h+n*s*o,t[1]=n*s*h-i*a*o,t[2]=n*a*o+i*s*h,t[3]=n*a*h-i*s*o):"YXZ"===r?(t[0]=i*a*h+n*s*o,t[1]=n*s*h-i*a*o,t[2]=n*a*o-i*s*h,t[3]=n*a*h+i*s*o):"ZXY"===r?(t[0]=i*a*h-n*s*o,t[1]=n*s*h+i*a*o,t[2]=n*a*o+i*s*h,t[3]=n*a*h-i*s*o):"ZYX"===r?(t[0]=i*a*h-n*s*o,t[1]=n*s*h+i*a*o,t[2]=n*a*o-i*s*h,t[3]=n*a*h+i*s*o):"YZX"===r?(t[0]=i*a*h+n*s*o,t[1]=n*s*h+i*a*o,t[2]=n*a*o-i*s*h,t[3]=n*a*h-i*s*o):"XZY"===r&&(t[0]=i*a*h-n*s*o,t[1]=n*s*h-i*a*o,t[2]=n*a*o+i*s*h,t[3]=n*a*h+i*s*o)}(this,t,t.order),this}fromAxisAngle(t,e){return mt(this,t,e),this}slerp(t,e){return vt(this,this,t,e),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}const St=new at;class _t extends Array{constructor(t=0,e=t,r=t,i="YXZ"){return super(t,e,r),this.order=i,this.onChange=()=>{},this}get x(){return this[0]}set x(t){this[0]=t,this.onChange()}get y(){return this[1]}set y(t){this[1]=t,this.onChange()}get z(){return this[2]}set z(t){this[2]=t,this.onChange()}set(t,e=t,r=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=r,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,r="YXZ"){"XYZ"===r?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===r?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===r?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===r?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===r?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===r&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return St.fromQuaternion(t),this.fromRotationMatrix(St,e)}}class Ot{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new at,this.worldMatrix=new at,this.matrixAutoUpdate=!0,this.position=new D,this.quaternion=new At,this.scale=new D(1),this.rotation=new _t,this.up=new D(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){e&&this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,r=this.children.length;e<r;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,r=this.children.length;e<r;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const kt=new at,Pt=new D,Lt=new D;class Tt extends Ot{constructor(t,{near:e=.1,far:r=100,fov:i=45,aspect:n=1,left:s,right:a,bottom:o,top:h}={}){super(),this.near=e,this.far=r,this.fov=i,this.aspect=n,this.projectionMatrix=new at,this.viewMatrix=new at,this.projectionViewMatrix=new at,this.worldPosition=new D,s||a?this.orthographic({left:s,right:a,bottom:o,top:h}):this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:r=this.fov,aspect:i=this.aspect}={}){return this.projectionMatrix.fromPerspective({fov:r*(Math.PI/180),aspect:i,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:r=-1,right:i=1,bottom:n=-1,top:s=1}={}){return this.projectionMatrix.fromOrthogonal({left:r,right:i,bottom:n,top:s,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(kt.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new D,new D,new D,new D,new D,new D]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere();const e=Pt;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);const r=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,r)}frustumIntersectsSphere(t,e){const r=Lt;for(let i=0;i<6;i++){const n=this.frustum[i];if(r.copy(n).dot(t)+n.constant<-e)return!1}return!0}}var jt=r(10),Ft=r.n(jt),Rt=n.Node.Attr,Ct=Symbol.for("spritejs_setAttribute"),It=Symbol.for("spritejs_getAttribute"),Nt=Symbol.for("spritejs_setAttributeDefault"),Dt=Symbol.for("spritejs_declareAlias"),Bt=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[Nt]({z:0,rotateX:0,rotateY:0,rotateZ:0,scaleX:0,scaleY:0,scaleZ:0,raycast:void 0}),r[Dt]("rotate","scale"),r}return k()(e,t),v()(e,[{key:"z",get:function(){return this[It]("z")},set:function(t){this[Ct]("z",t)}},{key:"raycast",get:function(){return this[It]("raycast")},set:function(t){this[Ct]("raycast",t)}},{key:"pos",get:function(){return[this.x,this.y,this.z]},set:function(t){Array.isArray(t)||(t=[t,t,t]),this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0}},{key:"rotateX",get:function(){return this[It]("rotateX")},set:function(t){this[Ct]("rotateX",t)}},{key:"rotateY",get:function(){return this[It]("rotateY")},set:function(t){this[Ct]("rotateY",t)}},{key:"rotateZ",get:function(){return this[It]("rotateZ")},set:function(t){this[Ct]("rotateZ",t)}},{key:"rotate",get:function(){return[this.rotateX,this.rotateY,this.rotateZ]},set:function(t){Array.isArray(t)||(t=[t,0,0]),this.rotateX=t[0]||0,this.rotateY=t[1]||0,this.rotateZ=t[2]||0}},{key:"scaleX",get:function(){return this[It]("scaleX")},set:function(t){this[Ct]("scaleX",t)}},{key:"scaleY",get:function(){return this[It]("scaleY")},set:function(t){this[Ct]("scaleY",t)}},{key:"scaleZ",get:function(){return this[It]("scaleZ")},set:function(t){this[Ct]("scaleZ",t)}},{key:"scale",get:function(){return[this.scaleX,this.scaleY,this.scaleZ]},set:function(t){Array.isArray(t)||(t=[t,0,0]),this.scaleX=t[0]||0,this.scaleY=t[1]||0,this.scaleZ=t[2]||0}}]),e}(Rt),Ut=Symbol("body"),zt=Symbol.for("spritejs_changedAttrs"),qt=function(t){function e(){return m()(this,e),w()(this,A()(e).apply(this,arguments))}return k()(e,t),v()(e,[{key:"setBody",value:function(t){var e=this[Ut];this[Ut]=t,e&&e.parent&&e.setParent(null),this.parent&&this.parent.body&&this[Ut].setParent(this.parent.body);for(var r=Object.entries(this.attributes[zt]),i=0;i<r.length;i++){var n=Ft()(r[i],2),s=n[0],a=n[1];this.onPropertyChange(s,a,a)}var o=this.uniforms;o&&this.setUniforms(o),!o&&r.length<=0&&this.forceUpdate(),t._node=this}},{key:"setUniforms",value:function(t){if(_()(A()(e.prototype),"setUniforms",this).call(this,t),this.body&&this.body.program){var r=this.body.program;Object.entries(t).forEach((function(t){var e=Ft()(t,2),i=e[0],n=e[1];r.uniforms[i]={value:n}}))}}},{key:"onPropertyChange",value:function(t,r,i){if(_()(A()(e.prototype),"onPropertyChange",this).call(this,t,r,i),this.body){if("x"!==t&&"y"!==t&&"z"!==t||(this.body.position[t]=r),"rotateX"===t||"rotateY"===t||"rotateZ"===t){var n=r*Math.PI/180;this.body.rotation[t.toLowerCase().slice(-1)]=n}"scaleX"!==t&&"scaleY"!==t&&"scaleZ"!==t||(this.body.scale[t.toLowerCase().slice(-1)]=r),"raycast"===t&&(this.body.geometry.raycast=r)}}},{key:"connect",value:function(t,r){_()(A()(e.prototype),"connect",this).call(this,t,r),t.body&&this.body&&this.body!==t.body&&this.body.setParent(t.body)}},{key:"disconnect",value:function(t,r){_()(A()(e.prototype),"disconnect",this).call(this,t,r),this.body&&this.body.setParent(null)}},{key:"body",get:function(){return this[Ut]?this[Ut]:null}},{key:"meshes",get:function(){return[]}}]),e}(n.Node);f()(qt,"Attr",Bt),Object(n.registerNode)(qt,"node3d");var Xt=Symbol.for("spritejs_setAttribute"),Yt=Symbol.for("spritejs_getAttribute"),Gt=Symbol.for("spritejs_setAttributeDefault"),Vt=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[Gt]({near:.1,far:100,fov:45,aspect:1,left:void 0,right:void 0,bottom:void 0,top:void 0}),r}return k()(e,t),v()(e,[{key:"near",get:function(){return this[Yt]("near")},set:function(t){this[Xt]("near",t)}},{key:"far",get:function(){return this[Yt]("far")},set:function(t){this[Xt]("far",t)}},{key:"fov",get:function(){return this[Yt]("fov")},set:function(t){this[Xt]("fov",t)}},{key:"aspect",get:function(){return this[Yt]("aspect")},set:function(t){this[Xt]("aspect",t)}},{key:"left",get:function(){return this[Yt]("left")},set:function(t){this[Xt]("left",t)}},{key:"right",get:function(){return this[Yt]("right")},set:function(t){this[Xt]("right",t)}},{key:"top",get:function(){return this[Yt]("top")},set:function(t){this[Xt]("top",t)}},{key:"bottom",get:function(){return this[Yt]("bottom")},set:function(t){this[Xt]("bottom",t)}}]),e}(Bt),Ht=function(t){function e(t,r){var i,n=r.parent,s=r.fov,a=void 0===s?45:s,o=r.near,h=void 0===o?.1:o,u=r.far,l=void 0===u?100:u,c=r.aspect,d=void 0===c?1:c;return m()(this,e),(i=w()(this,A()(e).call(this))).setBody(new Tt(t,{fov:a,near:h,far:l,aspect:d})),i.connect(n,0),i}return k()(e,t),v()(e,[{key:"lookAt",value:function(t){return t.body&&(t=t.body),this.body.lookAt(t)}},{key:"onPropertyChange",value:function(t,r,i){if(_()(A()(e.prototype),"onPropertyChange",this).call(this,t,r,i),this.body&&("near"===t||"far"===t||"fov"===t||"aspect"===t)){var n="fov"===t?r*(Math.PI/180):r;this.body.perspective(f()({},t,n))}}}]),e}(qt);f()(Ht,"Attr",Vt),Object(n.registerNode)(Ht,"camera");var Zt=Symbol("zOrder"),Wt=Symbol("children"),$t=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m()(this,e),(t=w()(this,A()(e).call(this,r))).setBody(new Ot),t[Wt]=[],t[Zt]=0,t}return k()(e,t),v()(e,[{key:"setBody",value:function(t){if(this.body)throw new Error("Cannot reset the body of group3d.");_()(A()(e.prototype),"setBody",this).call(this,t)}},{key:"append",value:function(){for(var t=this,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return r.map((function(e){return t.appendChild(e)}))}},{key:"appendChild",value:function(t){return t.remove(),this.children.push(t),t.connect(this,this[Zt]++),t}},{key:"cloneNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=_()(A()(e.prototype),"cloneNode",this).call(this);return t&&this[Wt].forEach((function(e){var i=e.cloneNode(t);r.appendChild(i)})),r}},{key:"getElementById",value:function(t){return n.Group.prototype.querySelector.call(this,"#".concat(t))}},{key:"getElementsByClassName",value:function(t){return n.Group.prototype.querySelectorAll.call(this,".".concat(t))}},{key:"getElementsByName",value:function(t){return n.Group.prototype.querySelectorAll.call(this,'[name="'.concat(t,'"]'))}},{key:"getElementsByTagName",value:function(t){return n.Group.prototype.querySelectorAll.call(this,t)}},{key:"insertBefore",value:function(t,e){if(null==e)return this.appendChild(t);t.remove();var r=this[Wt].indexOf(e);if(r<0)throw new Error("Invalid reference node.");for(var i=e.zOrder,n=r;n<this[Wt].length;n++){var s=this[Wt][n].zOrder,a=this[Wt][n];delete a.zOrder,Object.defineProperty(a,"zOrder",{value:s+1,writable:!1,configurable:!0})}return this[Wt].splice(r,0,t),t.connect(this,i),t}},{key:"querySelector",value:function(t){return n.Group.prototype.querySelector.call(this,t)}},{key:"querySelectorAll",value:function(t){return n.Group.prototype.querySelectorAll.call(this,t)}},{key:"replaceChild",value:function(t,e){t.remove();var r=this[Wt].indexOf(e);if(r<0)throw new Error("Invalid reference node.");return this[Wt][r]=t,t.connect(this,e.zOrder),e.disconnect(),t}},{key:"removeAllChildren",value:function(){for(var t=this[Wt],e=t.length-1;e>=0;e--)t[e].remove()}},{key:"removeChild",value:function(t){var e=this[Wt].indexOf(t);return e>=0?(this[Wt].splice(e,1),t.disconnect(),t):null}},{key:"setResolution",value:function(t){var r=t.width,i=t.height;_()(A()(e.prototype),"setResolution",this).call(this,{width:r,height:i}),this[Wt].forEach((function(t){t.setResolution({width:r,height:i})}))}},{key:"childNodes",get:function(){return this[Wt]}},{key:"children",get:function(){return this[Wt]}},{key:"meshes",get:function(){for(var t=this.children,e=[],r=0;r<t.length;r++){var i=t[r];i.meshes&&i.meshes.length&&e.push.apply(e,d()(i.meshes))}return e}}]),e}(qt);function Qt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Kt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Qt(Object(r),!0).forEach((function(e){f()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}Object(n.registerNode)($t,"group3d");var Jt={alpha:!0,depth:!0},te=Symbol("orbit_controls"),ee=Symbol("orbit_checker"),re=Symbol("orbit_checking"),ie=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(m()(this,e),"2d"===r.contextType)throw new TypeError("Cannot create 3d layer in 2d context.");r.Renderer||(r.Renderer=function(t,e){e=Object.assign({},Jt,e);var r=new U(Kt({canvas:t},e));return r.globalTransformMatrix=[1,0,0,1,0,0],r.setGlobalTransform=function(t){},r});var i=(t=w()(this,A()(e).call(this,r))).renderer.gl;i.clearColor(0,0,1,0);var n=r.camera||{},s=new Ht(i,Kt({parent:E()(t)},n));return s.attributes.z=5,t.camera=s,t.root=new $t,t.root.connect(E()(t),0),t}var r,i;return k()(e,t),v()(e,[{key:"setResolution",value:function(t){var r=t.width,i=t.height;_()(A()(e.prototype),"setResolution",this).call(this,{width:r,height:i});var n=this.displayRatio,s=this.renderer;this.renderer.dpr=n,s.width=r/n,s.height=i/n;var a=s.gl;a.canvas.width=r,a.canvas.height=i;var o=this.camera;o&&(o.attributes.aspect=r/i)}},{key:"createProgram",value:function(t){var e=this.renderer.gl;return new X(e,t)}},{key:"setOrbit",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this[ee]||(this[ee]=[function(){t[re]=!0},function(){t[re]=!1},function(){t[re]&&t.forceUpdate()},function(){t.forceUpdate()}]);var r=this.camera;if(this[te]&&(this[te].remove(),this.removeEventListener("mousedown",this[ee][0]),this.removeEventListener("mouseup",this[ee][1]),this.removeEventListener("mousemove",this[ee][2]),this.removeEventListener("touchstart",this[ee][3]),this.removeEventListener("touchend",this[ee][3]),this.removeEventListener("touchmove",this[ee][3]),window.removeEventListener("wheel",this[ee][3],!1)),null==e)return delete this[te],null;var i=e.target||[0,0,0];return e.target=l()(D,d()(i)),e.element=e.element||this.parent.container,this[te]=new it(r.body,e),this.addEventListener("mousedown",this[ee][0]),this.addEventListener("mouseup",this[ee][1]),this.addEventListener("mousemove",this[ee][2]),this.addEventListener("touchstart",this[ee][3]),this.addEventListener("touchend",this[ee][3]),this.addEventListener("touchmove",this[ee][3]),window.addEventListener("wheel",this[ee][3],!1),this[te]}},{key:"setRaycast",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t){var e=this.renderer.gl;this.raycast=new ct(e)}else delete this.raycast}},{key:"loadImage",value:(i=h()(a.a.mark((function t(e){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.ENV.loadImage(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"loadModel",value:(r=h()(a.a.mark((function t(e){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:return t.next=4,t.sent.json();case 4:return r=t.sent,t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"createTexture",value:function(t){var e=this.renderer.gl,r=new gt(e);return"string"==typeof t?this.loadImage(t).then((function(t){return r.image=t,r})):(r.image=t,r)}},{key:"dispatchPointerEvent",value:function(t){var e=this.raycast;if(e){var r=new K,i=this.renderer;r.set(t.x/i.width*2-1,2*(1-t.y/i.height)-1),e.castMouse(this.camera.body,r);var s=e.intersectBounds(this.meshes);if(s&&s.length){var a=s[0];return t.target=a._node,t.mouse=r,a._node.dispatchEvent(t),!0}}return n.Block.prototype.dispatchPointerEvent.call(this,t)}},{key:"render",value:function(){this[te]&&this[te].update(),this.renderer.render({scene:this.root.body,camera:this.camera.body}),this.prepareRender&&(this.prepareRender._requestID&&cancelAnimationFrame(this.prepareRender._requestID),this.prepareRender._resolve(),delete this.prepareRender)}},{key:"body",get:function(){return this.root?this.root.body:null}},{key:"meshes",get:function(){for(var t=this.children,e=[],r=0;r<t.length;r++){var i=t[r];i.meshes&&i.meshes.length&&e.push.apply(e,d()(i.meshes))}return e}},{key:"orbitControls",get:function(){return this[te]}}]),e}(n.Layer);Object(n.registerNode)(ie,"layer3d");function ne(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=r[0],p=r[1],f=r[2],g=r[3],m=r[4],y=r[5],v=r[6],b=r[7],w=r[8];return t[0]=d*i+p*a+f*u,t[1]=d*n+p*o+f*l,t[2]=d*s+p*h+f*c,t[3]=g*i+m*a+y*u,t[4]=g*n+m*o+y*l,t[5]=g*s+m*h+y*c,t[6]=v*i+b*a+w*u,t[7]=v*n+b*o+w*l,t[8]=v*s+b*h+w*c,t}class se extends Array{constructor(t=1,e=0,r=0,i=0,n=1,s=0,a=0,o=0,h=1){return super(t,e,r,i,n,s,a,o,h),this}set(t,e,r,i,n,s,a,o,h){return t.length?this.copy(t):(function(t,e,r,i,n,s,a,o,h,u){t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=o,t[7]=h,t[8]=u}(this,t,e,r,i,n,s,a,o,h),this)}translate(t,e=this){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=r[0],p=r[1];t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=o,t[5]=h,t[6]=d*i+p*a+u,t[7]=d*n+p*o+l,t[8]=d*s+p*h+c}(this,e,t),this}rotate(t,e=this){return function(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=Math.sin(r),p=Math.cos(r);t[0]=p*i+d*a,t[1]=p*n+d*o,t[2]=p*s+d*h,t[3]=p*a-d*i,t[4]=p*o-d*n,t[5]=p*h-d*s,t[6]=u,t[7]=l,t[8]=c}(this,e,t),this}scale(t,e=this){return function(t,e,r){let i=r[0],n=r[1];t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?ne(this,t,e):ne(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}fromMatrix4(t){var e,r;return r=t,(e=this)[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[4],e[4]=r[5],e[5]=r[6],e[6]=r[8],e[7]=r[9],e[8]=r[10],this}fromQuaternion(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,o=i+i,h=n+n,u=r*a,l=i*a,c=i*o,d=n*a,p=n*o,f=n*h,g=s*a,m=s*o,y=s*h;t[0]=1-c-f,t[3]=l-y,t[6]=d+m,t[1]=l+y,t[4]=1-u-f,t[7]=p-g,t[2]=d-m,t[5]=p+g,t[8]=1-u-c}(this,t),this}fromBasis(t,e,r){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],r[0],r[1],r[2]),this}inverse(t=this){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=l*a-o*u,d=-l*s+o*h,p=u*s-a*h,f=r*c+i*d+n*p;f&&(f=1/f,t[0]=c*f,t[1]=(-l*i+n*u)*f,t[2]=(o*i-n*a)*f,t[3]=d*f,t[4]=(l*r-n*h)*f,t[5]=(-o*r+n*s)*f,t[6]=p*f,t[7]=(-u*r+i*h)*f,t[8]=(a*r-i*s)*f)}(this,t),this}getNormalMatrix(t){return function(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],y=e[15],v=r*o-i*a,b=r*h-n*a,w=r*u-s*a,x=i*h-n*o,E=i*u-s*o,M=n*u-s*h,A=l*g-c*f,S=l*m-d*f,_=l*y-p*f,O=c*m-d*g,k=c*y-p*g,P=d*y-p*m,L=v*P-b*k+w*O+x*_-E*S+M*A;L&&(L=1/L,t[0]=(o*P-h*k+u*O)*L,t[1]=(h*_-a*P-u*S)*L,t[2]=(a*k-o*_+u*A)*L,t[3]=(n*k-i*P-s*O)*L,t[4]=(r*P-n*_+s*S)*L,t[5]=(i*_-r*k-s*A)*L,t[6]=(g*M-m*E+y*x)*L,t[7]=(m*w-f*M-y*b)*L,t[8]=(f*E-g*w+y*v)*L)}(this,t),this}}let ae=0;class oe extends Ot{constructor(t,{geometry:e,program:r,mode:i=t.TRIANGLES,frustumCulled:n=!0,renderOrder:s=0}={}){super(),this.gl=t,this.id=ae++,this.geometry=e,this.program=r,this.mode=i,this.frustumCulled=n,this.renderOrder=s,this.modelViewMatrix=new at,this.normalMatrix=new se,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach(e=>e&&e({mesh:this,camera:t})),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(e=>e&&e({mesh:this,camera:t}))}}const he=new D;let ue=1,le=1;class ce{constructor(t,e={}){this.gl=t,this.attributes=e,this.id=ue++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.id=le++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalize=e.normalize||!1,e.buffer=this.gl.createBuffer(),e.count=e.data.length/e.size,e.divisor=e.instanced||0,e.needsUpdate=!1,this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.id&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.id),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((t,e)=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const r=this.attributes[e];this.gl.bindBuffer(r.target,r.buffer),this.glState.boundBuffer=r.id,this.gl.vertexAttribPointer(t,r.size,r.type,r.normalize,0,0),this.gl.enableVertexAttribArray(t),this.gl.renderer.vertexAttribDivisor(t,r.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach((t,e)=>{const r=this.attributes[e];r.needsUpdate&&this.updateAttribute(r)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}computeBoundingBox(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||(this.bounds={min:new D,max:new D,center:new D,scale:new D,radius:1/0});const e=this.bounds.min,r=this.bounds.max,i=this.bounds.center,n=this.bounds.scale;e.set(1/0),r.set(-1/0);for(let i=0,n=t.length;i<n;i+=3){const n=t[i],s=t[i+1],a=t[i+2];e.x=Math.min(n,e.x),e.y=Math.min(s,e.y),e.z=Math.min(a,e.z),r.x=Math.max(n,r.x),r.y=Math.max(s,r.y),r.z=Math.max(a,r.z)}n.sub(r,e),i.add(e,r).divide(2)}computeBoundingSphere(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||this.computeBoundingBox(t);let e=0;for(let r=0,i=t.length;r<i;r+=3)he.fromArray(t,r),e=Math.max(e,this.bounds.center.squaredDistance(he));this.bounds.radius=Math.sqrt(e)}remove(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}function de(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function pe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?de(Object(r),!0).forEach((function(e){f()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var fe=Symbol.for("spritejs_changedAttrs"),ge=Symbol("program"),me=Symbol("geometry"),ye=Symbol("model"),ve=Symbol("mode"),be=Symbol("shaderAttrs"),we=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m()(this,e),!t||t instanceof X||(i=t,t=null);var n=i.mode;return n&&delete(i=pe({},i)).mode,(r=w()(this,A()(e).call(this,i)))[ve]=n||"TRIANGLES",t&&r.setProgram(t),r[be]={},r}return k()(e,t),v()(e,[{key:"cloneNode",value:function(){var t=new this.constructor(this[ge]),e=this.attributes[fe];return t[ve]=this[ve],t.setGeometry(this[ye]),t.attr(e),t}},{key:"setProgram",value:function(t){this[ge]=t;var e=t.gl,r=this[me];if(r){var i=new oe(e,{mode:e[this[ve]],geometry:r,program:t});this.setBody(i)}}},{key:"setGeometry",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this[ge],n=i.gl;if(t instanceof ce)e=t;else{var s=pe({position:{size:3,data:new Float32Array(t.position)},uv:{size:2,data:new Float32Array(t.uv)},normal:{size:3,data:new Float32Array(t.normal)}},r);t.index&&(s.index={data:new Uint16Array(t.index)}),e=new ce(n,s)}if(this.shaderSetters&&Object.entries(this.shaderSetters).forEach((function(t){var r=Ft()(t,2),i=r[0],n=r[1];e.addAttribute(i,n(e.attributes.position))})),this[me]=e,this[ye]=t,i){var a=new oe(n,{mode:n[this[ve]],geometry:e,program:i});this.setBody(a)}}},{key:"mode",get:function(){return this[ve]}},{key:"program",get:function(){return this[ge]}},{key:"geometry",get:function(){return this[me]}},{key:"shaderAttrs",get:function(){return this[be]}},{key:"meshes",get:function(){return this.body?[this.body]:[]}}]),e}(qt);Object(n.registerNode)(we,"mesh3d");class xe extends ce{constructor(t,{radius:e=.5,widthSegments:r=16,heightSegments:i=Math.ceil(.5*r),phiStart:n=0,phiLength:s=2*Math.PI,thetaStart:a=0,thetaLength:o=Math.PI,attributes:h={}}={}){const u=r,l=i,c=n,d=s,p=a,f=o,g=(u+1)*(l+1),m=u*l*6,y=new Float32Array(3*g),v=new Float32Array(3*g),b=new Float32Array(2*g),w=g>65536?new Uint32Array(m):new Uint16Array(m);let x=0,E=0,M=0,A=p+f;const S=[];let _=new D;for(let t=0;t<=l;t++){let r=[],i=t/l;for(let t=0;t<=u;t++,x++){let n=t/u,s=-e*Math.cos(c+n*d)*Math.sin(p+i*f),a=e*Math.cos(p+i*f),o=e*Math.sin(c+n*d)*Math.sin(p+i*f);y[3*x]=s,y[3*x+1]=a,y[3*x+2]=o,_.set(s,a,o).normalize(),v[3*x]=_.x,v[3*x+1]=_.y,v[3*x+2]=_.z,b[2*x]=n,b[2*x+1]=1-i,r.push(E++)}S.push(r)}for(let t=0;t<l;t++)for(let e=0;e<u;e++){let r=S[t][e+1],i=S[t][e],n=S[t+1][e],s=S[t+1][e+1];(0!==t||p>0)&&(w[3*M]=r,w[3*M+1]=i,w[3*M+2]=s,M++),(t!==l-1||A<Math.PI)&&(w[3*M]=i,w[3*M+1]=n,w[3*M+2]=s,M++)}Object.assign(h,{position:{size:3,data:y},normal:{size:3,data:v},uv:{size:2,data:b},index:{data:w}}),super(t,h)}}var Ee=r(14),Me=r.n(Ee),Ae=Symbol.for("spritejs_setAttribute"),Se=Symbol.for("spritejs_getAttribute"),_e=Symbol.for("spritejs_setAttributeDefault"),Oe=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[_e]({colors:[0,0,0,1],colorDivisor:3}),r}return k()(e,t),v()(e,[{key:"colors",get:function(){return this[Se]("colors")},set:function(t){if("string"==typeof t){var e=(t=t.replace(/\s*,\s*/g,",")).split(/\s+/g);t=(e=e.map((function(t){var e=Me()(t);return[e[0]/255,e[1]/255,e[2]/255,e[3]]}))).reduce((function(t,e){return[].concat(d()(t),d()(e))}))}else Array.isArray(t)&&("string"==typeof t[0]?t=t.reduce((function(t,e){var r=Me()(e);return t.push(r[0]/255,r[1]/255,r[2]/255,r[3]),t}),[]):Array.isArray(t[0])&&(t=t.reduce((function(t,e){return[].concat(d()(t),d()(e))}))));this[Ae]("colors",t)}},{key:"colorDivisor",get:function(){return this[Se]("colorDivisor")},set:function(t){this[Ae]("colorDivisor",t)}}]),e}(Bt),ke=Symbol.for("spritejs_setAttribute"),Pe=Symbol.for("spritejs_getAttribute"),Le=Symbol.for("spritejs_setAttributeDefault"),Te=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[Le]({radius:.5,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}),r}return k()(e,t),v()(e,[{key:"radius",get:function(){return this[Pe]("radius")},set:function(t){this[ke]("radius",t)}},{key:"widthSegments",get:function(){return this[Pe]("widthSegments")},set:function(t){this[ke]("widthSegments",t)}},{key:"heightSegments",get:function(){return this[Pe]("heightSegments")},set:function(t){this[ke]("heightSegments",t)}},{key:"phiStart",get:function(){return this[Pe]("phiStart")},set:function(t){this[ke]("phiStart",t)}},{key:"phiLength",get:function(){return this[Pe]("phiLength")},set:function(t){this[ke]("phiLength",t)}},{key:"thetaStart",get:function(){return this[Pe]("thetaStart")},set:function(t){this[ke]("thetaStart",t)}},{key:"thetaLength",get:function(){return this[Pe]("thetaLength")},set:function(t){this[ke]("thetaLength",t)}}]),e}(Oe),je=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m()(this,e),(r=w()(this,A()(e).call(this,t,i))).shaderSetters={color:function(t){for(var e=(t=t.data).length/3,i=new Float32Array(4*e),n=r.attributes.colors,s=n.length/4,a=r.attributes.colorDivisor,o=0;o<e;o++){var h=Math.floor(o/a)%s;i[4*o]=n[4*h],i[4*o+1]=n[4*h+1],i[4*o+2]=n[4*h+2],i[4*o+3]=n[4*h+3]}return{size:4,data:i}}},r}return k()(e,t),v()(e,[{key:"updateMesh",value:function(){var t=this;this.body?!this.prepareMeshUpdate&&this.remesh&&(this.prepareMeshUpdate=Promise.resolve().then((function(){delete t.prepareMeshUpdate,t.remesh()}))):this.remesh()}},{key:"onPropertyChange",value:function(t,r,i){_()(A()(e.prototype),"onPropertyChange",this).call(this,t,r,i),"colors"!==t&&"colorDivisor"!==t||r!==i&&this.updateMesh()}}]),e}(we);f()(je,"Attr",Oe),Object(n.registerNode)(je,"geometry");var Fe=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m()(this,e),(r=w()(this,A()(e).call(this,t,i))).updateMesh(),r}return k()(e,t),v()(e,[{key:"remesh",value:function(){var t=this.program.gl,e=this.attributes,r=e.radius,i=e.widthSegments,n=e.heightSegments,s=e.phiStart,a=e.phiLength,o=e.thetaStart,h=e.thetaLength,u=new xe(t,{radius:r,widthSegments:i,heightSegments:n,phiStart:s,phiLength:a,thetaStart:o,thetaLength:h});this.setGeometry(u)}},{key:"onPropertyChange",value:function(t,r,i){_()(A()(e.prototype),"onPropertyChange",this).call(this,t,r,i),"radius"!==t&&"widthSegments"!==t&&"heightSegments"!==t&&"phiStart"!==t&&"phiLength"!==t&&"thetaStart"!==t&&"thetaLength"!==t||r!==i&&this.updateMesh()}}]),e}(je);f()(Fe,"Attr",Te),Object(n.registerNode)(Fe,"sphere");class Re extends ce{constructor(t,{width:e=1,height:r=1,widthSegments:i=1,heightSegments:n=1,attributes:s={}}={}){const a=i,o=n,h=(a+1)*(o+1),u=a*o*6,l=new Float32Array(3*h),c=new Float32Array(3*h),d=new Float32Array(2*h),p=h>65536?new Uint32Array(u):new Uint16Array(u);Re.buildPlane(l,c,d,p,e,r,0,a,o),Object.assign(s,{position:{size:3,data:l},normal:{size:3,data:c},uv:{size:2,data:d},index:{data:p}}),super(t,s)}static buildPlane(t,e,r,i,n,s,a,o,h,u=0,l=1,c=2,d=1,p=-1,f=0,g=0){const m=f,y=n/o,v=s/h;for(let b=0;b<=h;b++){let w=b*v-s/2;for(let s=0;s<=o;s++,f++){let v=s*y-n/2;if(t[3*f+u]=v*d,t[3*f+l]=w*p,t[3*f+c]=a/2,e[3*f+u]=0,e[3*f+l]=0,e[3*f+c]=a>=0?1:-1,r[2*f]=s/o,r[2*f+1]=1-b/h,b===h||s===o)continue;let x=m+s+b*(o+1),E=m+s+(b+1)*(o+1),M=m+s+(b+1)*(o+1)+1,A=m+s+b*(o+1)+1;i[6*g]=x,i[6*g+1]=E,i[6*g+2]=A,i[6*g+3]=E,i[6*g+4]=M,i[6*g+5]=A,g++}}}}class Ce extends ce{constructor(t,{width:e=1,height:r=1,depth:i=1,widthSegments:n=1,heightSegments:s=1,depthSegments:a=1,attributes:o={}}={}){const h=n,u=s,l=a,c=(h+1)*(u+1)*2+(h+1)*(l+1)*2+(u+1)*(l+1)*2,d=6*(h*u*2+h*l*2+u*l*2),p=new Float32Array(3*c),f=new Float32Array(3*c),g=new Float32Array(2*c),m=c>65536?new Uint32Array(d):new Uint16Array(d);let y=0,v=0;Re.buildPlane(p,f,g,m,i,r,e,l,u,2,1,0,-1,-1,y,v),Re.buildPlane(p,f,g,m,i,r,-e,l,u,2,1,0,1,-1,y+=(l+1)*(u+1),v+=l*u),Re.buildPlane(p,f,g,m,e,i,r,l,u,0,2,1,1,1,y+=(l+1)*(u+1),v+=l*u),Re.buildPlane(p,f,g,m,e,i,-r,l,u,0,2,1,1,-1,y+=(h+1)*(l+1),v+=h*l),Re.buildPlane(p,f,g,m,e,r,-i,h,u,0,1,2,-1,-1,y+=(h+1)*(l+1),v+=h*l),Re.buildPlane(p,f,g,m,e,r,i,h,u,0,1,2,1,-1,y+=(h+1)*(u+1),v+=h*u),Object.assign(o,{position:{size:3,data:p},normal:{size:3,data:f},uv:{size:2,data:g},index:{data:m}}),super(t,o)}}var Ie=Symbol.for("spritejs_setAttributeDefault"),Ne=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[Ie]({colorDivisor:4}),r}return k()(e,t),e}(Oe),De=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m()(this,e),(r=w()(this,A()(e).call(this,t,i))).updateMesh(),r}return k()(e,t),v()(e,[{key:"remesh",value:function(){var t=this.program.gl,e=new Ce(t);this.setGeometry(e)}}]),e}(je);f()(De,"Attr",Ne),Object(n.registerNode)(De,"cube");var Be=Symbol.for("spritejs_setAttribute"),Ue=Symbol.for("spritejs_getAttribute"),ze=Symbol.for("spritejs_setAttributeDefault"),qe=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[ze]({width:1,height:1,widthSegments:1,heightSegments:1}),r}return k()(e,t),v()(e,[{key:"width",get:function(){return this[Ue]("width")},set:function(t){this[Be]("width",t)}},{key:"height",get:function(){return this[Ue]("height")},set:function(t){this[Be]("height",t)}},{key:"widthSegments",get:function(){return this[Ue]("widthSegments")},set:function(t){this[Be]("widthSegments",t)}},{key:"heightSegments",get:function(){return this[Ue]("heightSegments")},set:function(t){this[Be]("heightSegments",t)}}]),e}(Oe),Xe=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m()(this,e),(r=w()(this,A()(e).call(this,t,i))).updateMesh(),r}return k()(e,t),v()(e,[{key:"remesh",value:function(){var t=this.program.gl,e=this.attributes,r=e.width,i=e.height,n=e.widthSegments,s=e.heightSegments,a=new Re(t,{width:r,height:i,widthSegments:n,heightSegments:s});this.setGeometry(a)}},{key:"onPropertyChange",value:function(t,r,i){_()(A()(e.prototype),"onPropertyChange",this).call(this,t,r,i),"width"!==t&&"height"!==t&&"widthSegments"!==t&&"heightSegments"!==t||r!==i&&this.updateMesh()}}]),e}(je);f()(Xe,"Attr",qe),Object(n.registerNode)(Xe,"plane");class Ye extends ce{constructor(t,{radiusTop:e=.5,radiusBottom:r=.5,height:i=1,radialSegments:n=8,heightSegments:s=1,openEnded:a=!1,thetaStart:o=0,thetaLength:h=2*Math.PI,attributes:u={}}={}){const l=n,c=s,d=o,p=h,f=a?0:r&&e?2:1,g=(l+1)*(c+1+f)+f,m=l*c*6+f*l*3,y=new Float32Array(3*g),v=new Float32Array(3*g),b=new Float32Array(2*g),w=g>65536?new Uint32Array(m):new Uint16Array(m);let x=0,E=0;const M=[];function A(t){let n;const s=!0===t?e:r,a=!0===t?1:-1,o=x;for(y.set([0,.5*i*a,0],3*x),v.set([0,a,0],3*x),b.set([.5,.5],2*x),x++,n=0;n<=l;n++){const t=n/l*p+d,e=Math.cos(t),r=Math.sin(t);y.set([s*r,.5*i*a,s*e],3*x),v.set([0,a,0],3*x),b.set([.5*e+.5,.5*r*a+.5],2*x),x++}for(n=0;n<l;n++){const e=o+n+1;t?w.set([e,e+1,o],3*E):w.set([e+1,e,o],3*E),E++}}!function(){let t,n;const s=new D,a=(r-e)/i;for(n=0;n<=c;n++){const o=[],h=n/c,u=h*(r-e)+e;for(t=0;t<=l;t++){const e=t/l,r=e*p+d,n=Math.sin(r),c=Math.cos(r);y.set([u*n,(.5-h)*i,u*c],3*x),s.set(n,a,c).normalize(),v.set([s.x,s.y,s.z],3*x),b.set([e,1-h],2*x),o.push(x++)}M.push(o)}for(t=0;t<l;t++)for(n=0;n<c;n++){const e=M[n][t],r=M[n+1][t],i=M[n+1][t+1],s=M[n][t+1];w.set([e,r,s,r,i,s],3*E),E+=2}}(),a||(e&&A(!0),r&&A(!1)),Object.assign(u,{position:{size:3,data:y},normal:{size:3,data:v},uv:{size:2,data:b},index:{data:w}}),super(t,u)}}var Ge=Symbol.for("spritejs_setAttribute"),Ve=Symbol.for("spritejs_getAttribute"),He=Symbol.for("spritejs_setAttributeDefault"),Ze=function(t){function e(t){var r;return m()(this,e),(r=w()(this,A()(e).call(this,t)))[He]({radiusTop:.5,radiusBottom:.5,height:1,radialSegments:16,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI}),r}return k()(e,t),v()(e,[{key:"radiusTop",get:function(){return this[Ve]("radiusTop")},set:function(t){this[Ge]("radiusTop",t)}},{key:"radiusBottom",get:function(){return this[Ve]("radiusBottom")},set:function(t){this[Ge]("radiusBottom",t)}},{key:"height",get:function(){return this[Ve]("height")},set:function(t){this[Ge]("height",t)}},{key:"radialSegments",get:function(){return this[Ve]("radialSegments")},set:function(t){this[Ge]("radialSegments",t)}},{key:"heightSegments",get:function(){return this[Ve]("heightSegments")},set:function(t){this[Ge]("heightSegments",t)}},{key:"openEnded",get:function(){return this[Ve]("openEnded")},set:function(t){this[Ge]("openEnded",t)}},{key:"thetaStart",get:function(){return this[Ve]("thetaStart")},set:function(t){this[Ge]("thetaStart",t)}},{key:"thetaLength",get:function(){return this[Ve]("thetaLength")},set:function(t){this[Ge]("thetaLength",t)}}]),e}(Oe),We=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m()(this,e),(r=w()(this,A()(e).call(this,t,i))).updateMesh(),r}return k()(e,t),v()(e,[{key:"remesh",value:function(){var t=this.program.gl,e=this.attributes,r=e.radiusTop,i=e.radiusBottom,n=e.height,s=e.radialSegments,a=e.heightSegments,o=e.openEnded,h=e.thetaStart,u=e.thetaLength,l=new Ye(t,{radiusTop:r,radiusBottom:i,height:n,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:h,thetaLength:u});this.setGeometry(l)}},{key:"onPropertyChange",value:function(t,r,i){_()(A()(e.prototype),"onPropertyChange",this).call(this,t,r,i),"radiusTop"!==t&&"radiusBottom"!==t&&"height"!==t&&"radialSegments"!==t&&"heightSegments"!==t&&"openEnded"!==t&&"thetaStart"!==t&&"thetaLength"!==t||r!==i&&this.updateMesh()}}]),e}(je);f()(We,"Attr",Ze),Object(n.registerNode)(We,"cylinder");var $e={vertex:"precision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n\nvarying vec3 vNormal;\nvarying vec4 vColor;\n\nvoid main() {\n  vNormal = normalize(normalMatrix * normal);\n  vColor = color;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragment:"precision highp float;\nprecision highp int;\n\nvarying vec3 vNormal;\nvarying vec4 vColor;\n\nuniform vec4 lighting;\n\nvoid main() {\n  vec3 normal = normalize(vNormal);\n  float l = dot(normal, normalize(lighting.xyz));\n  gl_FragColor.rgb = vColor.rgb + l * lighting.w;\n  gl_FragColor.a = vColor.a;\n}"},Qe={vertex:"precision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n\nvarying vec3 vNormal;\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n  vNormal = normalize(normalMatrix * normal);\n  vColor = color;\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragment:"precision highp float;\nprecision highp int;\n\nvarying vec3 vNormal;\nvarying vec4 vColor;\n\nuniform vec4 lighting;\nuniform sampler2D tMap;\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 normal = normalize(vNormal);\n  vec3 tex = texture2D(tMap, vUv).rgb;\n\n  vec3 light = normalize(lighting.xyz);\n  float shading = dot(normal, light) * lighting.w;\n  gl_FragColor.rgb = tex + shading;\n  gl_FragColor.a = vColor.a;\n}"};r.d(e,"Layer3D",(function(){return ie})),r.d(e,"Sphere",(function(){return Fe})),r.d(e,"Plane",(function(){return Xe})),r.d(e,"Cube",(function(){return De})),r.d(e,"Cylinder",(function(){return We})),r.d(e,"Mesh3d",(function(){return we})),r.d(e,"Group3d",(function(){return $t})),r.d(e,"shaders",(function(){return i})),n.Scene.prototype.layer3d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default3d",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.options.displayRatio;(e=Object.assign({dpr:r},this.options,e)).id=t;for(var i=this.orderedChildren,n=0;n<i.length;n++)if(i[n].id===t)return i[n];var s=new ie(e);return this.appendChild(s),s}}])}));